(()=>{"use strict";var e={d:(t,s)=>{for(var n in s)e.o(s,n)&&!e.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:s[n]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r:e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}},t={};e.r(t),e.d(t,{APIConnectionError:()=>v,APIConnectionTimeoutError:()=>x,APIError:()=>b,APIUserAbortError:()=>_,AuthenticationError:()=>E,BadRequestError:()=>S,ConflictError:()=>P,InternalServerError:()=>k,NotFoundError:()=>R,OpenAIError:()=>y,PermissionDeniedError:()=>A,RateLimitError:()=>C,UnprocessableEntityError:()=>I});const s="4.38.2";let n,r,i,o,a,c,l,h,u,d=!1,f=null,p=null,m=null,g=null;class w{constructor(e){this.body=e}get[Symbol.toStringTag](){return"MultipartBody"}}n||function(e,t={auto:!1}){if(d)throw new Error(`you must \`import 'openai/shims/${e.kind}'\` before importing anything else from openai`);if(n)throw new Error(`can't \`import 'openai/shims/${e.kind}'\` after \`import 'openai/shims/${n}'\``);d=t.auto,n=e.kind,r=e.fetch,f=e.Request,p=e.Response,m=e.Headers,i=e.FormData,g=e.Blob,o=e.File,a=e.ReadableStream,c=e.getMultipartRequestOptions,l=e.getDefaultAgent,h=e.fileFromPath,u=e.isFsReadStream}(function({manuallyImported:e}={}){const t=e?"You may need to use polyfills":"Add one of these imports before your first `import â€¦ from 'openai'`:\n- `import 'openai/shims/node'` (if you're running on Node)\n- `import 'openai/shims/web'` (otherwise)\n";let s,n,r,i;try{s=fetch,n=Request,r=Response,i=Headers}catch(e){throw new Error(`this environment is missing the following Web Fetch API type: ${e.message}. ${t}`)}return{kind:"web",fetch:s,Request:n,Response:r,Headers:i,FormData:"undefined"!=typeof FormData?FormData:class{constructor(){throw new Error(`file uploads aren't supported in this environment yet as 'FormData' is undefined. ${t}`)}},Blob:"undefined"!=typeof Blob?Blob:class{constructor(){throw new Error(`file uploads aren't supported in this environment yet as 'Blob' is undefined. ${t}`)}},File:"undefined"!=typeof File?File:class{constructor(){throw new Error(`file uploads aren't supported in this environment yet as 'File' is undefined. ${t}`)}},ReadableStream:"undefined"!=typeof ReadableStream?ReadableStream:class{constructor(){throw new Error(`streaming isn't supported in this environment yet as 'ReadableStream' is undefined. ${t}`)}},getMultipartRequestOptions:async(e,t)=>({...t,body:new w(e)}),getDefaultAgent:e=>{},fileFromPath:()=>{throw new Error("The `fileFromPath` function is only supported in Node. See the README for more details: https://www.github.com/openai/openai-node#file-uploads")},isFsReadStream:e=>!1}}(),{auto:!0});class y extends Error{}class b extends y{constructor(e,t,s,n){super(`${b.makeMessage(e,t,s)}`),this.status=e,this.headers=n,this.request_id=n?.["x-request-id"];const r=t;this.error=r,this.code=r?.code,this.param=r?.param,this.type=r?.type}static makeMessage(e,t,s){const n=t?.message?"string"==typeof t.message?t.message:JSON.stringify(t.message):t?JSON.stringify(t):s;return e&&n?`${e} ${n}`:e?`${e} status code (no body)`:n||"(no status code or body)"}static generate(e,t,s,n){if(!e)return new v({cause:he(t)});const r=t?.error;return 400===e?new S(e,r,s,n):401===e?new E(e,r,s,n):403===e?new A(e,r,s,n):404===e?new R(e,r,s,n):409===e?new P(e,r,s,n):422===e?new I(e,r,s,n):429===e?new C(e,r,s,n):e>=500?new k(e,r,s,n):new b(e,r,s,n)}}class _ extends b{constructor({message:e}={}){super(void 0,void 0,e||"Request was aborted.",void 0),this.status=void 0}}class v extends b{constructor({message:e,cause:t}){super(void 0,void 0,e||"Connection error.",void 0),this.status=void 0,t&&(this.cause=t)}}class x extends v{constructor({message:e}={}){super({message:e??"Request timed out."})}}class S extends b{constructor(){super(...arguments),this.status=400}}class E extends b{constructor(){super(...arguments),this.status=401}}class A extends b{constructor(){super(...arguments),this.status=403}}class R extends b{constructor(){super(...arguments),this.status=404}}class P extends b{constructor(){super(...arguments),this.status=409}}class I extends b{constructor(){super(...arguments),this.status=422}}class C extends b{constructor(){super(...arguments),this.status=429}}class k extends b{}class O{constructor(e,t){this.iterator=e,this.controller=t}static fromSSEResponse(e,t){let s=!1;return new O((async function*(){if(s)throw new Error("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");s=!0;let n=!1;try{for await(const s of async function*(e,t){if(!e.body)throw t.abort(),new y("Attempted to iterate over a response with no body");const s=new $,n=new M,r=B(e.body);for await(const e of async function*(e){let t=new Uint8Array;for await(const s of e){if(null==s)continue;const e=s instanceof ArrayBuffer?new Uint8Array(s):"string"==typeof s?(new TextEncoder).encode(s):s;let n,r=new Uint8Array(t.length+e.length);for(r.set(t),r.set(e,t.length),t=r;-1!==(n=T(t));)yield t.slice(0,n),t=t.slice(n)}t.length>0&&(yield t)}(r))for(const t of n.decode(e)){const e=s.decode(t);e&&(yield e)}for(const e of n.flush()){const t=s.decode(e);t&&(yield t)}}(e,t))if(!n)if(s.data.startsWith("[DONE]"))n=!0;else if(null===s.event){let e;try{e=JSON.parse(s.data)}catch(e){throw console.error("Could not parse message into JSON:",s.data),console.error("From chunk:",s.raw),e}if(e&&e.error)throw new b(void 0,e.error,void 0,void 0);yield e}else{let e;try{e=JSON.parse(s.data)}catch(e){throw console.error("Could not parse message into JSON:",s.data),console.error("From chunk:",s.raw),e}if("error"==s.event)throw new b(void 0,e.error,e.message,void 0);yield{event:s.event,data:e}}n=!0}catch(e){if(e instanceof Error&&"AbortError"===e.name)return;throw e}finally{n||t.abort()}}),t)}static fromReadableStream(e,t){let s=!1;return new O((async function*(){if(s)throw new Error("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");s=!0;let n=!1;try{for await(const t of async function*(){const t=new M,s=B(e);for await(const e of s)for(const s of t.decode(e))yield s;for(const e of t.flush())yield e}())n||t&&(yield JSON.parse(t));n=!0}catch(e){if(e instanceof Error&&"AbortError"===e.name)return;throw e}finally{n||t.abort()}}),t)}[Symbol.asyncIterator](){return this.iterator()}tee(){const e=[],t=[],s=this.iterator(),n=n=>({next:()=>{if(0===n.length){const n=s.next();e.push(n),t.push(n)}return n.shift()}});return[new O((()=>n(e)),this.controller),new O((()=>n(t)),this.controller)]}toReadableStream(){const e=this;let t;const s=new TextEncoder;return new a({async start(){t=e[Symbol.asyncIterator]()},async pull(e){try{const{value:n,done:r}=await t.next();if(r)return e.close();const i=s.encode(JSON.stringify(n)+"\n");e.enqueue(i)}catch(t){e.error(t)}},async cancel(){await(t.return?.())}})}}function T(e){for(let t=0;t<e.length-2;t++){if(10===e[t]&&10===e[t+1])return t+2;if(13===e[t]&&13===e[t+1])return t+2;if(13===e[t]&&10===e[t+1]&&t+3<e.length&&13===e[t+2]&&10===e[t+3])return t+4}return-1}class ${constructor(){this.event=null,this.data=[],this.chunks=[]}decode(e){if(e.endsWith("\r")&&(e=e.substring(0,e.length-1)),!e){if(!this.event&&!this.data.length)return null;const e={event:this.event,data:this.data.join("\n"),raw:this.chunks};return this.event=null,this.data=[],this.chunks=[],e}if(this.chunks.push(e),e.startsWith(":"))return null;let[t,s,n]=function(e,t){const s=e.indexOf(":");return-1!==s?[e.substring(0,s),":",e.substring(s+1)]:[e,"",""]}(e);return n.startsWith(" ")&&(n=n.substring(1)),"event"===t?this.event=n:"data"===t&&this.data.push(n),null}}class M{constructor(){this.buffer=[],this.trailingCR=!1}decode(e){let t=this.decodeText(e);if(this.trailingCR&&(t="\r"+t,this.trailingCR=!1),t.endsWith("\r")&&(this.trailingCR=!0,t=t.slice(0,-1)),!t)return[];const s=M.NEWLINE_CHARS.has(t[t.length-1]||"");let n=t.split(M.NEWLINE_REGEXP);return s&&n.pop(),1!==n.length||s?(this.buffer.length>0&&(n=[this.buffer.join("")+n[0],...n.slice(1)],this.buffer=[]),s||(this.buffer=[n.pop()||""]),n):(this.buffer.push(n[0]),[])}decodeText(e){if(null==e)return"";if("string"==typeof e)return e;if("undefined"!=typeof Buffer){if(e instanceof Buffer)return e.toString();if(e instanceof Uint8Array)return Buffer.from(e).toString();throw new y(`Unexpected: received non-Uint8Array (${e.constructor.name}) stream chunk in an environment with a global "Buffer" defined, which this library assumes to be Node. Please report this error.`)}if("undefined"!=typeof TextDecoder){if(e instanceof Uint8Array||e instanceof ArrayBuffer)return this.textDecoder??(this.textDecoder=new TextDecoder("utf8")),this.textDecoder.decode(e);throw new y(`Unexpected: received non-Uint8Array/ArrayBuffer (${e.constructor.name}) in a web platform. Please report this error.`)}throw new y("Unexpected: neither Buffer nor TextDecoder are available as globals. Please report this error.")}flush(){if(!this.buffer.length&&!this.trailingCR)return[];const e=[this.buffer.join("")];return this.buffer=[],this.trailingCR=!1,e}}function B(e){if(e[Symbol.asyncIterator])return e;const t=e.getReader();return{async next(){try{const e=await t.read();return e?.done&&t.releaseLock(),e}catch(e){throw t.releaseLock(),e}},async return(){const e=t.cancel();return t.releaseLock(),await e,{done:!0,value:void 0}},[Symbol.asyncIterator](){return this}}}M.NEWLINE_CHARS=new Set(["\n","\r"]),M.NEWLINE_REGEXP=/\r\n|[\n\r]/g;const j=e=>null!=e&&"object"==typeof e&&"string"==typeof e.url&&"function"==typeof e.blob,q=e=>null!=e&&"object"==typeof e&&"string"==typeof e.name&&"number"==typeof e.lastModified&&L(e),L=e=>null!=e&&"object"==typeof e&&"number"==typeof e.size&&"string"==typeof e.type&&"function"==typeof e.text&&"function"==typeof e.slice&&"function"==typeof e.arrayBuffer;async function N(e,t,s){if(e=await e,s??(s=q(e)?{lastModified:e.lastModified,type:e.type}:{}),j(e)){const n=await e.blob();return t||(t=new URL(e.url).pathname.split(/[\\/]/).pop()??"unknown_file"),new o([n],t,s)}const n=await async function(e){let t=[];if("string"==typeof e||ArrayBuffer.isView(e)||e instanceof ArrayBuffer)t.push(e);else if(L(e))t.push(await e.arrayBuffer());else{if(!W(e))throw new Error(`Unexpected data type: ${typeof e}; constructor: ${e?.constructor?.name}; props: ${function(e){return`[${Object.getOwnPropertyNames(e).map((e=>`"${e}"`)).join(", ")}]`}(e)}`);for await(const s of e)t.push(s)}return t}(e);if(t||(t=function(e){return F(e.name)||F(e.filename)||F(e.path)?.split(/[\\/]/).pop()}(e)??"unknown_file"),!s.type){const e=n[0]?.type;"string"==typeof e&&(s={...s,type:e})}return new o(n,t,s)}const F=e=>"string"==typeof e?e:"undefined"!=typeof Buffer&&e instanceof Buffer?String(e):void 0,W=e=>null!=e&&"object"==typeof e&&"function"==typeof e[Symbol.asyncIterator],D=e=>e&&"object"==typeof e&&e.body&&"MultipartBody"===e[Symbol.toStringTag],U=async e=>{const t=await X(e.body);return c(t,e)},X=async e=>{const t=new i;return await Promise.all(Object.entries(e||{}).map((([e,s])=>H(t,e,s)))),t},H=async(e,t,s)=>{if(void 0!==s){if(null==s)throw new TypeError(`Received null for "${t}"; to pass null in FormData, you must use the string 'null'`);if("string"==typeof s||"number"==typeof s||"boolean"==typeof s)e.append(t,String(s));else if((e=>q(e)||j(e)||u(e))(s)){const n=await N(s);e.append(t,n)}else if(Array.isArray(s))await Promise.all(s.map((s=>H(e,t+"[]",s))));else{if("object"!=typeof s)throw new TypeError(`Invalid value given to form, expected a string, number, boolean, object, Array, File or Blob but got ${s} instead`);await Promise.all(Object.entries(s).map((([s,n])=>H(e,`${t}[${s}]`,n))))}}};var J;async function V(e){const{response:t}=e;if(e.options.stream)return me("response",t.status,t.url,t.headers,t.body),e.options.__streamClass?e.options.__streamClass.fromSSEResponse(t,e.controller):O.fromSSEResponse(t,e.controller);if(204===t.status)return null;if(e.options.__binaryResponse)return t;const s=t.headers.get("content-type");if(s?.includes("application/json")||s?.includes("application/vnd.api+json")){const e=await t.json();return me("response",t.status,t.url,t.headers,e),e}const n=await t.text();return me("response",t.status,t.url,t.headers,n),n}class K extends Promise{constructor(e,t=V){super((e=>{e(null)})),this.responsePromise=e,this.parseResponse=t}_thenUnwrap(e){return new K(this.responsePromise,(async t=>e(await this.parseResponse(t))))}asResponse(){return this.responsePromise.then((e=>e.response))}async withResponse(){const[e,t]=await Promise.all([this.parse(),this.asResponse()]);return{data:e,response:t}}parse(){return this.parsedPromise||(this.parsedPromise=this.responsePromise.then(this.parseResponse)),this.parsedPromise}then(e,t){return this.parse().then(e,t)}catch(e){return this.parse().catch(e)}finally(e){return this.parse().finally(e)}}class G{constructor({baseURL:e,maxRetries:t=2,timeout:s=6e5,httpAgent:n,fetch:i}){this.baseURL=e,this.maxRetries=le("maxRetries",t),this.timeout=le("timeout",s),this.httpAgent=n,this.fetch=i??r}authHeaders(e){return{}}defaultHeaders(e){return{Accept:"application/json","Content-Type":"application/json","User-Agent":this.getUserAgent(),...re(),...this.authHeaders(e)}}validateHeaders(e,t){}defaultIdempotencyKey(){return`stainless-node-retry-${ge()}`}get(e,t){return this.methodRequest("get",e,t)}post(e,t){return this.methodRequest("post",e,t)}patch(e,t){return this.methodRequest("patch",e,t)}put(e,t){return this.methodRequest("put",e,t)}delete(e,t){return this.methodRequest("delete",e,t)}methodRequest(e,t,s){return this.request(Promise.resolve(s).then((s=>({method:e,path:t,...s}))))}getAPIList(e,t,s){return this.requestAPIList(t,{method:"get",path:e,...s})}calculateContentLength(e){if("string"==typeof e){if("undefined"!=typeof Buffer)return Buffer.byteLength(e,"utf8").toString();if("undefined"!=typeof TextEncoder)return(new TextEncoder).encode(e).length.toString()}return null}buildRequest(e){const{method:t,path:s,query:n,headers:r={}}=e,i=D(e.body)?e.body.body:e.body?JSON.stringify(e.body,null,2):null,o=this.calculateContentLength(i),a=this.buildURL(s,n);"timeout"in e&&le("timeout",e.timeout);const c=e.timeout??this.timeout,h=e.httpAgent??this.httpAgent??l(a),u=c+1e3;return"number"==typeof h?.options?.timeout&&u>(h.options.timeout??0)&&(h.options.timeout=u),this.idempotencyHeader&&"get"!==t&&(e.idempotencyKey||(e.idempotencyKey=this.defaultIdempotencyKey()),r[this.idempotencyHeader]=e.idempotencyKey),{req:{method:t,...i&&{body:i},headers:this.buildHeaders({options:e,headers:r,contentLength:o}),...h&&{agent:h},signal:e.signal??null},url:a,timeout:c}}buildHeaders({options:e,headers:t,contentLength:s}){const r={};return s&&(r["content-length"]=s),pe(r,this.defaultHeaders(e)),pe(r,t),D(e.body)&&"node"!==n&&delete r["content-type"],this.validateHeaders(r,t),r}async prepareOptions(e){}async prepareRequest(e,{url:t,options:s}){}parseHeaders(e){return e?Symbol.iterator in e?Object.fromEntries(Array.from(e).map((e=>[...e]))):{...e}:{}}makeStatusError(e,t,s,n){return b.generate(e,t,s,n)}request(e,t=null){return new K(this.makeRequest(e,t))}async makeRequest(e,t){const s=await e;null==t&&(t=s.maxRetries??this.maxRetries),await this.prepareOptions(s);const{req:n,url:r,timeout:i}=this.buildRequest(s);if(await this.prepareRequest(n,{url:r,options:s}),me("request",r,s,n.headers),s.signal?.aborted)throw new _;const o=new AbortController,a=await this.fetchWithTimeout(r,n,i,o).catch(he);if(a instanceof Error){if(s.signal?.aborted)throw new _;if(t)return this.retryRequest(s,t);if("AbortError"===a.name)throw new x;throw new v({cause:a})}const c=Y(a.headers);if(!a.ok){if(t&&this.shouldRetry(a))return me(`response (error; retrying, ${t} attempts remaining)`,a.status,r,c),this.retryRequest(s,t,c);const e=await a.text().catch((e=>he(e).message)),n=ie(e),i=n?void 0:e;throw me(`response (error; ${t?"(error; no more retries left)":"(error; not retryable)"})`,a.status,r,c,i),this.makeStatusError(a.status,n,i,c)}return{response:a,options:s,controller:o}}requestAPIList(e,t){const s=this.makeRequest(t,null);return new Q(this,s,e)}buildURL(e,t){const s=ae(e)?new URL(e):new URL(this.baseURL+(this.baseURL.endsWith("/")&&e.startsWith("/")?e.slice(1):e)),n=this.defaultQuery();return de(n)||(t={...n,...t}),"object"==typeof t&&t&&!Array.isArray(t)&&(s.search=this.stringifyQuery(t)),s.toString()}stringifyQuery(e){return Object.entries(e).filter((([e,t])=>void 0!==t)).map((([e,t])=>{if("string"==typeof t||"number"==typeof t||"boolean"==typeof t)return`${encodeURIComponent(e)}=${encodeURIComponent(t)}`;if(null===t)return`${encodeURIComponent(e)}=`;throw new y(`Cannot stringify type ${typeof t}; Expected string, number, boolean, or null. If you need to pass nested query parameters, you can manually encode them, e.g. { query: { 'foo[key1]': value1, 'foo[key2]': value2 } }, and please open a GitHub issue requesting better support for your use case.`)})).join("&")}async fetchWithTimeout(e,t,s,n){const{signal:r,...i}=t||{};r&&r.addEventListener("abort",(()=>n.abort()));const o=setTimeout((()=>n.abort()),s);return this.getRequestClient().fetch.call(void 0,e,{signal:n.signal,...i}).finally((()=>{clearTimeout(o)}))}getRequestClient(){return{fetch:this.fetch}}shouldRetry(e){const t=e.headers.get("x-should-retry");return"true"===t||"false"!==t&&(408===e.status||409===e.status||429===e.status||e.status>=500)}async retryRequest(e,t,s){let n;const r=s?.["retry-after-ms"];if(r){const e=parseFloat(r);Number.isNaN(e)||(n=e)}const i=s?.["retry-after"];if(i&&!n){const e=parseFloat(i);n=Number.isNaN(e)?Date.parse(i)-Date.now():1e3*e}if(!(n&&0<=n&&n<6e4)){const s=e.maxRetries??this.maxRetries;n=this.calculateDefaultRetryTimeoutMillis(t,s)}return await ce(n),this.makeRequest(e,t-1)}calculateDefaultRetryTimeoutMillis(e,t){const s=t-e;return Math.min(.5*Math.pow(2,s),8)*(1-.25*Math.random())*1e3}getUserAgent(){return`${this.constructor.name}/JS ${s}`}}class z{constructor(e,t,s,n){J.set(this,void 0),function(e,t,s,n,r){if("m"===n)throw new TypeError("Private method is not writable");if("a"===n&&!r)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!r:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");"a"===n?r.call(e,s):r?r.value=s:t.set(e,s)}(this,J,e,"f"),this.options=n,this.response=t,this.body=s}hasNextPage(){return!!this.getPaginatedItems().length&&null!=this.nextPageInfo()}async getNextPage(){const e=this.nextPageInfo();if(!e)throw new y("No next page expected; please check `.hasNextPage()` before calling `.getNextPage()`.");const t={...this.options};if("params"in e&&"object"==typeof t.query)t.query={...t.query,...e.params};else if("url"in e){const s=[...Object.entries(t.query||{}),...e.url.searchParams.entries()];for(const[t,n]of s)e.url.searchParams.set(t,n);t.query=void 0,t.path=e.url.toString()}return await function(e,t,s,n){if("a"===s&&!n)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!n:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===s?n:"a"===s?n.call(e):n?n.value:t.get(e)}(this,J,"f").requestAPIList(this.constructor,t)}async*iterPages(){let e=this;for(yield e;e.hasNextPage();)e=await e.getNextPage(),yield e}async*[(J=new WeakMap,Symbol.asyncIterator)](){for await(const e of this.iterPages())for(const t of e.getPaginatedItems())yield t}}class Q extends K{constructor(e,t,s){super(t,(async t=>new s(e,t.response,await V(t),t.options)))}async*[Symbol.asyncIterator](){const e=await(this);for await(const t of e)yield t}}const Y=e=>new Proxy(Object.fromEntries(e.entries()),{get(e,t){const s=t.toString();return e[s.toLowerCase()]||e[s]}}),Z={method:!0,path:!0,query:!0,body:!0,headers:!0,maxRetries:!0,stream:!0,timeout:!0,httpAgent:!0,signal:!0,idempotencyKey:!0,__binaryResponse:!0,__streamClass:!0},ee=e=>"object"==typeof e&&null!==e&&!de(e)&&Object.keys(e).every((e=>fe(Z,e))),te=e=>"x32"===e?"x32":"x86_64"===e||"x64"===e?"x64":"arm"===e?"arm":"aarch64"===e||"arm64"===e?"arm64":e?`other:${e}`:"unknown",se=e=>(e=e.toLowerCase()).includes("ios")?"iOS":"android"===e?"Android":"darwin"===e?"MacOS":"win32"===e?"Windows":"freebsd"===e?"FreeBSD":"openbsd"===e?"OpenBSD":"linux"===e?"Linux":e?`Other:${e}`:"Unknown";let ne;const re=()=>ne??(ne=(()=>{if("undefined"!=typeof Deno&&null!=Deno.build)return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":s,"X-Stainless-OS":se(Deno.build.os),"X-Stainless-Arch":te(Deno.build.arch),"X-Stainless-Runtime":"deno","X-Stainless-Runtime-Version":"string"==typeof Deno.version?Deno.version:Deno.version?.deno??"unknown"};if("undefined"!=typeof EdgeRuntime)return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":s,"X-Stainless-OS":"Unknown","X-Stainless-Arch":`other:${EdgeRuntime}`,"X-Stainless-Runtime":"edge","X-Stainless-Runtime-Version":process.version};if("[object process]"===Object.prototype.toString.call("undefined"!=typeof process?process:0))return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":s,"X-Stainless-OS":se(process.platform),"X-Stainless-Arch":te(process.arch),"X-Stainless-Runtime":"node","X-Stainless-Runtime-Version":process.version};const e=function(){if("undefined"==typeof navigator||!navigator)return null;const e=[{key:"edge",pattern:/Edge(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/MSIE(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/Trident(?:.*rv\:(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"chrome",pattern:/Chrome(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"firefox",pattern:/Firefox(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"safari",pattern:/(?:Version\W+(\d+)\.(\d+)(?:\.(\d+))?)?(?:\W+Mobile\S*)?\W+Safari/}];for(const{key:t,pattern:s}of e){const e=s.exec(navigator.userAgent);if(e)return{browser:t,version:`${e[1]||0}.${e[2]||0}.${e[3]||0}`}}return null}();return e?{"X-Stainless-Lang":"js","X-Stainless-Package-Version":s,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":`browser:${e.browser}`,"X-Stainless-Runtime-Version":e.version}:{"X-Stainless-Lang":"js","X-Stainless-Package-Version":s,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":"unknown","X-Stainless-Runtime-Version":"unknown"}})()),ie=e=>{try{return JSON.parse(e)}catch(e){return}},oe=new RegExp("^(?:[a-z]+:)?//","i"),ae=e=>oe.test(e),ce=e=>new Promise((t=>setTimeout(t,e))),le=(e,t)=>{if("number"!=typeof t||!Number.isInteger(t))throw new y(`${e} must be an integer`);if(t<0)throw new y(`${e} must be a positive integer`);return t},he=e=>e instanceof Error?e:new Error(e),ue=e=>"undefined"!=typeof process?process.env?.[e]?.trim()??void 0:"undefined"!=typeof Deno?Deno.env?.get?.(e)?.trim():void 0;function de(e){if(!e)return!0;for(const t in e)return!1;return!0}function fe(e,t){return Object.prototype.hasOwnProperty.call(e,t)}function pe(e,t){for(const s in t){if(!fe(t,s))continue;const n=s.toLowerCase();if(!n)continue;const r=t[s];null===r?delete e[n]:void 0!==r&&(e[n]=r)}}function me(e,...t){"undefined"!=typeof process&&"true"===process?.env?.DEBUG&&console.log(`OpenAI:DEBUG:${e}`,...t)}const ge=()=>"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(e=>{const t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)}));function we(e){return null!=e&&"object"==typeof e&&!Array.isArray(e)}class ye extends z{constructor(e,t,s,n){super(e,t,s,n),this.data=s.data||[],this.object=s.object}getPaginatedItems(){return this.data??[]}nextPageParams(){return null}nextPageInfo(){return null}}class be extends z{constructor(e,t,s,n){super(e,t,s,n),this.data=s.data||[]}getPaginatedItems(){return this.data??[]}nextPageParams(){const e=this.nextPageInfo();if(!e)return null;if("params"in e)return e.params;const t=Object.fromEntries(e.url.searchParams);return Object.keys(t).length?t:null}nextPageInfo(){const e=this.getPaginatedItems();if(!e.length)return null;const t=e[e.length-1]?.id;return t?{params:{after:t}}:null}}class _e{constructor(e){this._client=e}}class ve extends _e{create(e,t){return this._client.post("/completions",{body:e,...t,stream:e.stream??!1})}}ve||(ve={});class xe extends _e{create(e,t){return this._client.post("/chat/completions",{body:e,...t,stream:e.stream??!1})}}xe||(xe={});class Se extends _e{constructor(){super(...arguments),this.completions=new xe(this._client)}}!function(e){e.Completions=xe}(Se||(Se={}));class Ee extends _e{create(e,t){return this._client.post("/embeddings",{body:e,...t})}}Ee||(Ee={});class Ae extends _e{create(e,t){return this._client.post("/files",U({body:e,...t}))}retrieve(e,t){return this._client.get(`/files/${e}`,t)}list(e={},t){return ee(e)?this.list({},e):this._client.getAPIList("/files",Re,{query:e,...t})}del(e,t){return this._client.delete(`/files/${e}`,t)}content(e,t){return this._client.get(`/files/${e}/content`,{...t,__binaryResponse:!0})}retrieveContent(e,t){return this._client.get(`/files/${e}/content`,{...t,headers:{Accept:"application/json",...t?.headers}})}async waitForProcessing(e,{pollInterval:t=5e3,maxWait:s=18e5}={}){const n=new Set(["processed","error","deleted"]),r=Date.now();let i=await this.retrieve(e);for(;!i.status||!n.has(i.status);)if(await ce(t),i=await this.retrieve(e),Date.now()-r>s)throw new x({message:`Giving up on waiting for file ${e} to finish processing after ${s} milliseconds.`});return i}}class Re extends ye{}!function(e){e.FileObjectsPage=Re}(Ae||(Ae={}));class Pe extends _e{createVariation(e,t){return this._client.post("/images/variations",U({body:e,...t}))}edit(e,t){return this._client.post("/images/edits",U({body:e,...t}))}generate(e,t){return this._client.post("/images/generations",{body:e,...t})}}Pe||(Pe={});class Ie extends _e{create(e,t){return this._client.post("/audio/speech",{body:e,...t,__binaryResponse:!0})}}Ie||(Ie={});class Ce extends _e{create(e,t){return this._client.post("/audio/transcriptions",U({body:e,...t}))}}Ce||(Ce={});class ke extends _e{create(e,t){return this._client.post("/audio/translations",U({body:e,...t}))}}ke||(ke={});class Oe extends _e{constructor(){super(...arguments),this.transcriptions=new Ce(this._client),this.translations=new ke(this._client),this.speech=new Ie(this._client)}}!function(e){e.Transcriptions=Ce,e.Translations=ke,e.Speech=Ie}(Oe||(Oe={}));class Te extends _e{create(e,t){return this._client.post("/moderations",{body:e,...t})}}Te||(Te={});class $e extends _e{retrieve(e,t){return this._client.get(`/models/${e}`,t)}list(e){return this._client.getAPIList("/models",Me,e)}del(e,t){return this._client.delete(`/models/${e}`,t)}}class Me extends ye{}!function(e){e.ModelsPage=Me}($e||($e={}));class Be extends _e{list(e,t={},s){return ee(t)?this.list(e,{},t):this._client.getAPIList(`/fine_tuning/jobs/${e}/checkpoints`,je,{query:t,...s})}}class je extends be{}!function(e){e.FineTuningJobCheckpointsPage=je}(Be||(Be={}));class qe extends _e{constructor(){super(...arguments),this.checkpoints=new Be(this._client)}create(e,t){return this._client.post("/fine_tuning/jobs",{body:e,...t})}retrieve(e,t){return this._client.get(`/fine_tuning/jobs/${e}`,t)}list(e={},t){return ee(e)?this.list({},e):this._client.getAPIList("/fine_tuning/jobs",Le,{query:e,...t})}cancel(e,t){return this._client.post(`/fine_tuning/jobs/${e}/cancel`,t)}listEvents(e,t={},s){return ee(t)?this.listEvents(e,{},t):this._client.getAPIList(`/fine_tuning/jobs/${e}/events`,Ne,{query:t,...s})}}class Le extends be{}class Ne extends be{}!function(e){e.FineTuningJobsPage=Le,e.FineTuningJobEventsPage=Ne,e.Checkpoints=Be,e.FineTuningJobCheckpointsPage=je}(qe||(qe={}));class Fe extends _e{constructor(){super(...arguments),this.jobs=new qe(this._client)}}!function(e){e.Jobs=qe,e.FineTuningJobsPage=Le,e.FineTuningJobEventsPage=Ne}(Fe||(Fe={}));class We extends _e{create(e,t){return this._client.post("/assistants",{body:e,...t,headers:{"OpenAI-Beta":"assistants=v2",...t?.headers}})}retrieve(e,t){return this._client.get(`/assistants/${e}`,{...t,headers:{"OpenAI-Beta":"assistants=v2",...t?.headers}})}update(e,t,s){return this._client.post(`/assistants/${e}`,{body:t,...s,headers:{"OpenAI-Beta":"assistants=v2",...s?.headers}})}list(e={},t){return ee(e)?this.list({},e):this._client.getAPIList("/assistants",De,{query:e,...t,headers:{"OpenAI-Beta":"assistants=v2",...t?.headers}})}del(e,t){return this._client.delete(`/assistants/${e}`,{...t,headers:{"OpenAI-Beta":"assistants=v2",...t?.headers}})}}class De extends be{}function Ue(e){return"function"==typeof e.parse}!function(e){e.AssistantsPage=De}(We||(We={}));const Xe=e=>"assistant"===e?.role,He=e=>"function"===e?.role,Je=e=>"tool"===e?.role;var Ve,Ke,Ge,ze,Qe,Ye,Ze,et,tt,st,nt,rt,it,ot,at,ct,lt,ht,ut,dt,ft=function(e,t,s,n,r){if("m"===n)throw new TypeError("Private method is not writable");if("a"===n&&!r)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!r:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===n?r.call(e,s):r?r.value=s:t.set(e,s),s},pt=function(e,t,s,n){if("a"===s&&!n)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!n:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===s?n:"a"===s?n.call(e):n?n.value:t.get(e)};const mt=10;class gt{constructor(){Ve.add(this),this.controller=new AbortController,Ke.set(this,void 0),Ge.set(this,(()=>{})),ze.set(this,(()=>{})),Qe.set(this,void 0),Ye.set(this,(()=>{})),Ze.set(this,(()=>{})),et.set(this,{}),this._chatCompletions=[],this.messages=[],tt.set(this,!1),st.set(this,!1),nt.set(this,!1),rt.set(this,!1),ht.set(this,(e=>{if(ft(this,st,!0,"f"),e instanceof Error&&"AbortError"===e.name&&(e=new _),e instanceof _)return ft(this,nt,!0,"f"),this._emit("abort",e);if(e instanceof y)return this._emit("error",e);if(e instanceof Error){const t=new y(e.message);return t.cause=e,this._emit("error",t)}return this._emit("error",new y(String(e)))})),ft(this,Ke,new Promise(((e,t)=>{ft(this,Ge,e,"f"),ft(this,ze,t,"f")})),"f"),ft(this,Qe,new Promise(((e,t)=>{ft(this,Ye,e,"f"),ft(this,Ze,t,"f")})),"f"),pt(this,Ke,"f").catch((()=>{})),pt(this,Qe,"f").catch((()=>{}))}_run(e){setTimeout((()=>{e().then((()=>{this._emitFinal(),this._emit("end")}),pt(this,ht,"f"))}),0)}_addChatCompletion(e){this._chatCompletions.push(e),this._emit("chatCompletion",e);const t=e.choices[0]?.message;return t&&this._addMessage(t),e}_addMessage(e,t=!0){if("content"in e||(e.content=null),this.messages.push(e),t)if(this._emit("message",e),(He(e)||Je(e))&&e.content)this._emit("functionCallResult",e.content);else if(Xe(e)&&e.function_call)this._emit("functionCall",e.function_call);else if(Xe(e)&&e.tool_calls)for(const t of e.tool_calls)"function"===t.type&&this._emit("functionCall",t.function)}_connected(){this.ended||(pt(this,Ge,"f").call(this),this._emit("connect"))}get ended(){return pt(this,tt,"f")}get errored(){return pt(this,st,"f")}get aborted(){return pt(this,nt,"f")}abort(){this.controller.abort()}on(e,t){return(pt(this,et,"f")[e]||(pt(this,et,"f")[e]=[])).push({listener:t}),this}off(e,t){const s=pt(this,et,"f")[e];if(!s)return this;const n=s.findIndex((e=>e.listener===t));return n>=0&&s.splice(n,1),this}once(e,t){return(pt(this,et,"f")[e]||(pt(this,et,"f")[e]=[])).push({listener:t,once:!0}),this}emitted(e){return new Promise(((t,s)=>{ft(this,rt,!0,"f"),"error"!==e&&this.once("error",s),this.once(e,t)}))}async done(){ft(this,rt,!0,"f"),await pt(this,Qe,"f")}async finalChatCompletion(){await this.done();const e=this._chatCompletions[this._chatCompletions.length-1];if(!e)throw new y("stream ended without producing a ChatCompletion");return e}async finalContent(){return await this.done(),pt(this,Ve,"m",it).call(this)}async finalMessage(){return await this.done(),pt(this,Ve,"m",ot).call(this)}async finalFunctionCall(){return await this.done(),pt(this,Ve,"m",at).call(this)}async finalFunctionCallResult(){return await this.done(),pt(this,Ve,"m",ct).call(this)}async totalUsage(){return await this.done(),pt(this,Ve,"m",lt).call(this)}allChatCompletions(){return[...this._chatCompletions]}_emit(e,...t){if(pt(this,tt,"f"))return;"end"===e&&(ft(this,tt,!0,"f"),pt(this,Ye,"f").call(this));const s=pt(this,et,"f")[e];if(s&&(pt(this,et,"f")[e]=s.filter((e=>!e.once)),s.forEach((({listener:e})=>e(...t)))),"abort"===e){const e=t[0];return pt(this,rt,"f")||s?.length||Promise.reject(e),pt(this,ze,"f").call(this,e),pt(this,Ze,"f").call(this,e),void this._emit("end")}if("error"===e){const e=t[0];pt(this,rt,"f")||s?.length||Promise.reject(e),pt(this,ze,"f").call(this,e),pt(this,Ze,"f").call(this,e),this._emit("end")}}_emitFinal(){const e=this._chatCompletions[this._chatCompletions.length-1];e&&this._emit("finalChatCompletion",e);const t=pt(this,Ve,"m",ot).call(this);t&&this._emit("finalMessage",t);const s=pt(this,Ve,"m",it).call(this);s&&this._emit("finalContent",s);const n=pt(this,Ve,"m",at).call(this);n&&this._emit("finalFunctionCall",n);const r=pt(this,Ve,"m",ct).call(this);null!=r&&this._emit("finalFunctionCallResult",r),this._chatCompletions.some((e=>e.usage))&&this._emit("totalUsage",pt(this,Ve,"m",lt).call(this))}async _createChatCompletion(e,t,s){const n=s?.signal;n&&(n.aborted&&this.controller.abort(),n.addEventListener("abort",(()=>this.controller.abort()))),pt(this,Ve,"m",ut).call(this,t);const r=await e.create({...t,stream:!1},{...s,signal:this.controller.signal});return this._connected(),this._addChatCompletion(r)}async _runChatCompletion(e,t,s){for(const e of t.messages)this._addMessage(e,!1);return await this._createChatCompletion(e,t,s)}async _runFunctions(e,t,s){const n="function",{function_call:r="auto",stream:i,...o}=t,a="string"!=typeof r&&r?.name,{maxChatCompletions:c=mt}=s||{},l={};for(const e of t.functions)l[e.name||e.function.name]=e;const h=t.functions.map((e=>({name:e.name||e.function.name,parameters:e.parameters,description:e.description})));for(const e of t.messages)this._addMessage(e,!1);for(let t=0;t<c;++t){const t=await this._createChatCompletion(e,{...o,function_call:r,functions:h,messages:[...this.messages]},s),i=t.choices[0]?.message;if(!i)throw new y("missing message in ChatCompletion response");if(!i.function_call)return;const{name:c,arguments:u}=i.function_call,d=l[c];if(!d){const e=`Invalid function_call: ${JSON.stringify(c)}. Available options are: ${h.map((e=>JSON.stringify(e.name))).join(", ")}. Please try again`;this._addMessage({role:n,name:c,content:e});continue}if(a&&a!==c){const e=`Invalid function_call: ${JSON.stringify(c)}. ${JSON.stringify(a)} requested. Please try again`;this._addMessage({role:n,name:c,content:e});continue}let f;try{f=Ue(d)?await d.parse(u):u}catch(e){this._addMessage({role:n,name:c,content:e instanceof Error?e.message:String(e)});continue}const p=await d.function(f,this),m=pt(this,Ve,"m",dt).call(this,p);if(this._addMessage({role:n,name:c,content:m}),a)return}}async _runTools(e,t,s){const n="tool",{tool_choice:r="auto",stream:i,...o}=t,a="string"!=typeof r&&r?.function?.name,{maxChatCompletions:c=mt}=s||{},l={};for(const e of t.tools)"function"===e.type&&(l[e.function.name||e.function.function.name]=e.function);const h="tools"in t?t.tools.map((e=>"function"===e.type?{type:"function",function:{name:e.function.name||e.function.function.name,parameters:e.function.parameters,description:e.function.description}}:e)):void 0;for(const e of t.messages)this._addMessage(e,!1);for(let t=0;t<c;++t){const t=await this._createChatCompletion(e,{...o,tool_choice:r,tools:h,messages:[...this.messages]},s),i=t.choices[0]?.message;if(!i)throw new y("missing message in ChatCompletion response");if(!i.tool_calls)return;for(const e of i.tool_calls){if("function"!==e.type)continue;const t=e.id,{name:s,arguments:r}=e.function,i=l[s];if(!i){const e=`Invalid tool_call: ${JSON.stringify(s)}. Available options are: ${h.map((e=>JSON.stringify(e.function.name))).join(", ")}. Please try again`;this._addMessage({role:n,tool_call_id:t,content:e});continue}if(a&&a!==s){const e=`Invalid tool_call: ${JSON.stringify(s)}. ${JSON.stringify(a)} requested. Please try again`;this._addMessage({role:n,tool_call_id:t,content:e});continue}let o;try{o=Ue(i)?await i.parse(r):r}catch(e){const s=e instanceof Error?e.message:String(e);this._addMessage({role:n,tool_call_id:t,content:s});continue}const c=await i.function(o,this),u=pt(this,Ve,"m",dt).call(this,c);if(this._addMessage({role:n,tool_call_id:t,content:u}),a)return}}}}Ke=new WeakMap,Ge=new WeakMap,ze=new WeakMap,Qe=new WeakMap,Ye=new WeakMap,Ze=new WeakMap,et=new WeakMap,tt=new WeakMap,st=new WeakMap,nt=new WeakMap,rt=new WeakMap,ht=new WeakMap,Ve=new WeakSet,it=function(){return pt(this,Ve,"m",ot).call(this).content??null},ot=function(){let e=this.messages.length;for(;e-- >0;){const t=this.messages[e];if(Xe(t))return{...t,content:t.content??null}}throw new y("stream ended without producing a ChatCompletionMessage with role=assistant")},at=function(){for(let e=this.messages.length-1;e>=0;e--){const t=this.messages[e];if(Xe(t)&&t?.function_call)return t.function_call;if(Xe(t)&&t?.tool_calls?.length)return t.tool_calls.at(-1)?.function}},ct=function(){for(let e=this.messages.length-1;e>=0;e--){const t=this.messages[e];if(He(t)&&null!=t.content)return t.content;if(Je(t)&&null!=t.content&&this.messages.some((e=>"assistant"===e.role&&e.tool_calls?.some((e=>"function"===e.type&&e.id===t.tool_call_id)))))return t.content}},lt=function(){const e={completion_tokens:0,prompt_tokens:0,total_tokens:0};for(const{usage:t}of this._chatCompletions)t&&(e.completion_tokens+=t.completion_tokens,e.prompt_tokens+=t.prompt_tokens,e.total_tokens+=t.total_tokens);return e},ut=function(e){if(null!=e.n&&e.n>1)throw new y("ChatCompletion convenience helpers only support n=1 at this time. To use n>1, please use chat.completions.create() directly.")},dt=function(e){return"string"==typeof e?e:void 0===e?"undefined":JSON.stringify(e)};class wt extends gt{static runFunctions(e,t,s){const n=new wt,r={...s,headers:{...s?.headers,"X-Stainless-Helper-Method":"runFunctions"}};return n._run((()=>n._runFunctions(e,t,r))),n}static runTools(e,t,s){const n=new wt,r={...s,headers:{...s?.headers,"X-Stainless-Helper-Method":"runTools"}};return n._run((()=>n._runTools(e,t,r))),n}_addMessage(e){super._addMessage(e),Xe(e)&&e.content&&this._emit("content",e.content)}}var yt,bt,_t,vt,xt,St,Et=function(e,t,s,n){if("a"===s&&!n)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!n:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===s?n:"a"===s?n.call(e):n?n.value:t.get(e)},At=function(e,t,s,n,r){if("m"===n)throw new TypeError("Private method is not writable");if("a"===n&&!r)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!r:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===n?r.call(e,s):r?r.value=s:t.set(e,s),s};class Rt extends gt{constructor(){super(...arguments),yt.add(this),bt.set(this,void 0)}get currentChatCompletionSnapshot(){return Et(this,bt,"f")}static fromReadableStream(e){const t=new Rt;return t._run((()=>t._fromReadableStream(e))),t}static createChatCompletion(e,t,s){const n=new Rt;return n._run((()=>n._runChatCompletion(e,{...t,stream:!0},{...s,headers:{...s?.headers,"X-Stainless-Helper-Method":"stream"}}))),n}async _createChatCompletion(e,t,s){const n=s?.signal;n&&(n.aborted&&this.controller.abort(),n.addEventListener("abort",(()=>this.controller.abort()))),Et(this,yt,"m",_t).call(this);const r=await e.create({...t,stream:!0},{...s,signal:this.controller.signal});this._connected();for await(const e of r)Et(this,yt,"m",vt).call(this,e);if(r.controller.signal?.aborted)throw new _;return this._addChatCompletion(Et(this,yt,"m",xt).call(this))}async _fromReadableStream(e,t){const s=t?.signal;s&&(s.aborted&&this.controller.abort(),s.addEventListener("abort",(()=>this.controller.abort()))),Et(this,yt,"m",_t).call(this),this._connected();const n=O.fromReadableStream(e,this.controller);let r;for await(const e of n)r&&r!==e.id&&this._addChatCompletion(Et(this,yt,"m",xt).call(this)),Et(this,yt,"m",vt).call(this,e),r=e.id;if(n.controller.signal?.aborted)throw new _;return this._addChatCompletion(Et(this,yt,"m",xt).call(this))}[(bt=new WeakMap,yt=new WeakSet,_t=function(){this.ended||At(this,bt,void 0,"f")},vt=function(e){if(this.ended)return;const t=Et(this,yt,"m",St).call(this,e);this._emit("chunk",e,t);const s=e.choices[0]?.delta?.content,n=t.choices[0]?.message;null!=s&&"assistant"===n?.role&&n?.content&&this._emit("content",s,n.content)},xt=function(){if(this.ended)throw new y("stream has ended, this shouldn't happen");const e=Et(this,bt,"f");if(!e)throw new y("request ended without sending any chunks");return At(this,bt,void 0,"f"),function(e){const{id:t,choices:s,created:n,model:r,system_fingerprint:i,...o}=e;return{...o,id:t,choices:s.map((({message:t,finish_reason:s,index:n,logprobs:r,...i})=>{if(!s)throw new y(`missing finish_reason for choice ${n}`);const{content:o=null,function_call:a,tool_calls:c,...l}=t,h=t.role;if(!h)throw new y(`missing role for choice ${n}`);if(a){const{arguments:e,name:t}=a;if(null==e)throw new y(`missing function_call.arguments for choice ${n}`);if(!t)throw new y(`missing function_call.name for choice ${n}`);return{...i,message:{content:o,function_call:{arguments:e,name:t},role:h},finish_reason:s,index:n,logprobs:r}}return c?{...i,index:n,finish_reason:s,logprobs:r,message:{...l,role:h,content:o,tool_calls:c.map(((t,s)=>{const{function:r,type:i,id:o,...a}=t,{arguments:c,name:l,...h}=r||{};if(null==o)throw new y(`missing choices[${n}].tool_calls[${s}].id\n${Pt(e)}`);if(null==i)throw new y(`missing choices[${n}].tool_calls[${s}].type\n${Pt(e)}`);if(null==l)throw new y(`missing choices[${n}].tool_calls[${s}].function.name\n${Pt(e)}`);if(null==c)throw new y(`missing choices[${n}].tool_calls[${s}].function.arguments\n${Pt(e)}`);return{...a,id:o,type:i,function:{...h,name:l,arguments:c}}}))}}:{...i,message:{...l,content:o,role:h},finish_reason:s,index:n,logprobs:r}})),created:n,model:r,object:"chat.completion",...i?{system_fingerprint:i}:{}}}(e)},St=function(e){var t,s,n;let r=Et(this,bt,"f");const{choices:i,...o}=e;r?Object.assign(r,o):r=At(this,bt,{...o,choices:[]},"f");for(const{delta:i,finish_reason:o,index:a,logprobs:c=null,...l}of e.choices){let e=r.choices[a];if(e||(e=r.choices[a]={finish_reason:o,index:a,message:{},logprobs:c,...l}),c)if(e.logprobs){const{content:s,...n}=c;Object.assign(e.logprobs,n),s&&((t=e.logprobs).content??(t.content=[]),e.logprobs.content.push(...s))}else e.logprobs=Object.assign({},c);if(o&&(e.finish_reason=o),Object.assign(e,l),!i)continue;const{content:h,function_call:u,role:d,tool_calls:f,...p}=i;if(Object.assign(e.message,p),h&&(e.message.content=(e.message.content||"")+h),d&&(e.message.role=d),u&&(e.message.function_call?(u.name&&(e.message.function_call.name=u.name),u.arguments&&((s=e.message.function_call).arguments??(s.arguments=""),e.message.function_call.arguments+=u.arguments)):e.message.function_call=u),f){e.message.tool_calls||(e.message.tool_calls=[]);for(const{index:t,id:s,type:r,function:i,...o}of f){const a=(n=e.message.tool_calls)[t]??(n[t]={});Object.assign(a,o),s&&(a.id=s),r&&(a.type=r),i&&(a.function??(a.function={arguments:""})),i?.name&&(a.function.name=i.name),i?.arguments&&(a.function.arguments+=i.arguments)}}}return r},Symbol.asyncIterator)](){const e=[],t=[];let s=!1;return this.on("chunk",(s=>{const n=t.shift();n?n.resolve(s):e.push(s)})),this.on("end",(()=>{s=!0;for(const e of t)e.resolve(void 0);t.length=0})),this.on("abort",(e=>{s=!0;for(const s of t)s.reject(e);t.length=0})),this.on("error",(e=>{s=!0;for(const s of t)s.reject(e);t.length=0})),{next:async()=>e.length?{value:e.shift(),done:!1}:s?{value:void 0,done:!0}:new Promise(((e,s)=>t.push({resolve:e,reject:s}))).then((e=>e?{value:e,done:!1}:{value:void 0,done:!0})),return:async()=>(this.abort(),{value:void 0,done:!0})}}toReadableStream(){return new O(this[Symbol.asyncIterator].bind(this),this.controller).toReadableStream()}}function Pt(e){return JSON.stringify(e)}class It extends Rt{static fromReadableStream(e){const t=new It;return t._run((()=>t._fromReadableStream(e))),t}static runFunctions(e,t,s){const n=new It,r={...s,headers:{...s?.headers,"X-Stainless-Helper-Method":"runFunctions"}};return n._run((()=>n._runFunctions(e,t,r))),n}static runTools(e,t,s){const n=new It,r={...s,headers:{...s?.headers,"X-Stainless-Helper-Method":"runTools"}};return n._run((()=>n._runTools(e,t,r))),n}}class Ct extends _e{runFunctions(e,t){return e.stream?It.runFunctions(this._client.chat.completions,e,t):wt.runFunctions(this._client.chat.completions,e,t)}runTools(e,t){return e.stream?It.runTools(this._client.chat.completions,e,t):wt.runTools(this._client.chat.completions,e,t)}stream(e,t){return Rt.createChatCompletion(this._client.chat.completions,e,t)}}class kt extends _e{constructor(){super(...arguments),this.completions=new Ct(this._client)}}!function(e){e.Completions=Ct}(kt||(kt={}));var Ot,Tt,$t,Mt,Bt,jt,qt,Lt,Nt,Ft,Wt,Dt,Ut=function(e,t,s,n,r){if("m"===n)throw new TypeError("Private method is not writable");if("a"===n&&!r)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!r:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===n?r.call(e,s):r?r.value=s:t.set(e,s),s},Xt=function(e,t,s,n){if("a"===s&&!n)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!n:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===s?n:"a"===s?n.call(e):n?n.value:t.get(e)};class Ht{constructor(){this.controller=new AbortController,Ot.set(this,void 0),Tt.set(this,(()=>{})),$t.set(this,(()=>{})),Mt.set(this,void 0),Bt.set(this,(()=>{})),jt.set(this,(()=>{})),qt.set(this,{}),Lt.set(this,!1),Nt.set(this,!1),Ft.set(this,!1),Wt.set(this,!1),Dt.set(this,(e=>{if(Ut(this,Nt,!0,"f"),e instanceof Error&&"AbortError"===e.name&&(e=new _),e instanceof _)return Ut(this,Ft,!0,"f"),this._emit("abort",e);if(e instanceof y)return this._emit("error",e);if(e instanceof Error){const t=new y(e.message);return t.cause=e,this._emit("error",t)}return this._emit("error",new y(String(e)))})),Ut(this,Ot,new Promise(((e,t)=>{Ut(this,Tt,e,"f"),Ut(this,$t,t,"f")})),"f"),Ut(this,Mt,new Promise(((e,t)=>{Ut(this,Bt,e,"f"),Ut(this,jt,t,"f")})),"f"),Xt(this,Ot,"f").catch((()=>{})),Xt(this,Mt,"f").catch((()=>{}))}_run(e){setTimeout((()=>{e().then((()=>{this._emit("end")}),Xt(this,Dt,"f"))}),0)}_addRun(e){return e}_connected(){this.ended||(Xt(this,Tt,"f").call(this),this._emit("connect"))}get ended(){return Xt(this,Lt,"f")}get errored(){return Xt(this,Nt,"f")}get aborted(){return Xt(this,Ft,"f")}abort(){this.controller.abort()}on(e,t){return(Xt(this,qt,"f")[e]||(Xt(this,qt,"f")[e]=[])).push({listener:t}),this}off(e,t){const s=Xt(this,qt,"f")[e];if(!s)return this;const n=s.findIndex((e=>e.listener===t));return n>=0&&s.splice(n,1),this}once(e,t){return(Xt(this,qt,"f")[e]||(Xt(this,qt,"f")[e]=[])).push({listener:t,once:!0}),this}emitted(e){return new Promise(((t,s)=>{Ut(this,Wt,!0,"f"),"error"!==e&&this.once("error",s),this.once(e,t)}))}async done(){Ut(this,Wt,!0,"f"),await Xt(this,Mt,"f")}_emit(e,...t){if(Xt(this,Lt,"f"))return;"end"===e&&(Ut(this,Lt,!0,"f"),Xt(this,Bt,"f").call(this));const s=Xt(this,qt,"f")[e];if(s&&(Xt(this,qt,"f")[e]=s.filter((e=>!e.once)),s.forEach((({listener:e})=>e(...t)))),"abort"===e){const e=t[0];return Xt(this,Wt,"f")||s?.length||Promise.reject(e),Xt(this,$t,"f").call(this,e),Xt(this,jt,"f").call(this,e),void this._emit("end")}if("error"===e){const e=t[0];Xt(this,Wt,"f")||s?.length||Promise.reject(e),Xt(this,$t,"f").call(this,e),Xt(this,jt,"f").call(this,e),this._emit("end")}}async _threadAssistantStream(e,t,s){return await this._createThreadAssistantStream(t,e,s)}async _runAssistantStream(e,t,s,n){return await this._createAssistantStream(t,e,s,n)}async _runToolAssistantStream(e,t,s,n,r){return await this._createToolAssistantStream(s,e,t,n,r)}async _createThreadAssistantStream(e,t,s){const n=s?.signal;n&&(n.aborted&&this.controller.abort(),n.addEventListener("abort",(()=>this.controller.abort())));const r=await e.createAndRun({...t,stream:!1},{...s,signal:this.controller.signal});return this._connected(),this._addRun(r)}async _createToolAssistantStream(e,t,s,n,r){const i=r?.signal;i&&(i.aborted&&this.controller.abort(),i.addEventListener("abort",(()=>this.controller.abort())));const o=await e.submitToolOutputs(t,s,{...n,stream:!1},{...r,signal:this.controller.signal});return this._connected(),this._addRun(o)}async _createAssistantStream(e,t,s,n){const r=n?.signal;r&&(r.aborted&&this.controller.abort(),r.addEventListener("abort",(()=>this.controller.abort())));const i=await e.create(t,{...s,stream:!1},{...n,signal:this.controller.signal});return this._connected(),this._addRun(i)}}Ot=new WeakMap,Tt=new WeakMap,$t=new WeakMap,Mt=new WeakMap,Bt=new WeakMap,jt=new WeakMap,qt=new WeakMap,Lt=new WeakMap,Nt=new WeakMap,Ft=new WeakMap,Wt=new WeakMap,Dt=new WeakMap;var Jt,Vt,Kt,Gt,zt,Qt,Yt,Zt,es,ts,ss,ns,rs,is,os,as,cs,ls,hs,us,ds,fs,ps,ms=function(e,t,s,n){if("a"===s&&!n)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!n:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===s?n:"a"===s?n.call(e):n?n.value:t.get(e)},gs=function(e,t,s,n,r){if("m"===n)throw new TypeError("Private method is not writable");if("a"===n&&!r)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!r:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===n?r.call(e,s):r?r.value=s:t.set(e,s),s};class ws extends Ht{constructor(){super(...arguments),Jt.add(this),Vt.set(this,[]),Kt.set(this,{}),Gt.set(this,{}),zt.set(this,void 0),Qt.set(this,void 0),Yt.set(this,void 0),Zt.set(this,void 0),es.set(this,void 0),ts.set(this,void 0),ss.set(this,void 0),ns.set(this,void 0),rs.set(this,void 0)}[(Vt=new WeakMap,Kt=new WeakMap,Gt=new WeakMap,zt=new WeakMap,Qt=new WeakMap,Yt=new WeakMap,Zt=new WeakMap,es=new WeakMap,ts=new WeakMap,ss=new WeakMap,ns=new WeakMap,rs=new WeakMap,Jt=new WeakSet,Symbol.asyncIterator)](){const e=[],t=[];let s=!1;return this.on("event",(s=>{const n=t.shift();n?n.resolve(s):e.push(s)})),this.on("end",(()=>{s=!0;for(const e of t)e.resolve(void 0);t.length=0})),this.on("abort",(e=>{s=!0;for(const s of t)s.reject(e);t.length=0})),this.on("error",(e=>{s=!0;for(const s of t)s.reject(e);t.length=0})),{next:async()=>e.length?{value:e.shift(),done:!1}:s?{value:void 0,done:!0}:new Promise(((e,s)=>t.push({resolve:e,reject:s}))).then((e=>e?{value:e,done:!1}:{value:void 0,done:!0})),return:async()=>(this.abort(),{value:void 0,done:!0})}}static fromReadableStream(e){const t=new ws;return t._run((()=>t._fromReadableStream(e))),t}async _fromReadableStream(e,t){const s=t?.signal;s&&(s.aborted&&this.controller.abort(),s.addEventListener("abort",(()=>this.controller.abort()))),this._connected();const n=O.fromReadableStream(e,this.controller);for await(const e of n)ms(this,Jt,"m",is).call(this,e);if(n.controller.signal?.aborted)throw new _;return this._addRun(ms(this,Jt,"m",os).call(this))}toReadableStream(){return new O(this[Symbol.asyncIterator].bind(this),this.controller).toReadableStream()}static createToolAssistantStream(e,t,s,n,r){const i=new ws;return i._run((()=>i._runToolAssistantStream(e,t,s,n,{...r,headers:{...r?.headers,"X-Stainless-Helper-Method":"stream"}}))),i}async _createToolAssistantStream(e,t,s,n,r){const i=r?.signal;i&&(i.aborted&&this.controller.abort(),i.addEventListener("abort",(()=>this.controller.abort())));const o={...n,stream:!0},a=await e.submitToolOutputs(t,s,o,{...r,signal:this.controller.signal});this._connected();for await(const e of a)ms(this,Jt,"m",is).call(this,e);if(a.controller.signal?.aborted)throw new _;return this._addRun(ms(this,Jt,"m",os).call(this))}static createThreadAssistantStream(e,t,s){const n=new ws;return n._run((()=>n._threadAssistantStream(e,t,{...s,headers:{...s?.headers,"X-Stainless-Helper-Method":"stream"}}))),n}static createAssistantStream(e,t,s,n){const r=new ws;return r._run((()=>r._runAssistantStream(e,t,s,{...n,headers:{...n?.headers,"X-Stainless-Helper-Method":"stream"}}))),r}currentEvent(){return ms(this,ss,"f")}currentRun(){return ms(this,ns,"f")}currentMessageSnapshot(){return ms(this,zt,"f")}currentRunStepSnapshot(){return ms(this,rs,"f")}async finalRunSteps(){return await this.done(),Object.values(ms(this,Kt,"f"))}async finalMessages(){return await this.done(),Object.values(ms(this,Gt,"f"))}async finalRun(){if(await this.done(),!ms(this,Qt,"f"))throw Error("Final run was not received.");return ms(this,Qt,"f")}async _createThreadAssistantStream(e,t,s){const n=s?.signal;n&&(n.aborted&&this.controller.abort(),n.addEventListener("abort",(()=>this.controller.abort())));const r={...t,stream:!0},i=await e.createAndRun(r,{...s,signal:this.controller.signal});this._connected();for await(const e of i)ms(this,Jt,"m",is).call(this,e);if(i.controller.signal?.aborted)throw new _;return this._addRun(ms(this,Jt,"m",os).call(this))}async _createAssistantStream(e,t,s,n){const r=n?.signal;r&&(r.aborted&&this.controller.abort(),r.addEventListener("abort",(()=>this.controller.abort())));const i={...s,stream:!0},o=await e.create(t,i,{...n,signal:this.controller.signal});this._connected();for await(const e of o)ms(this,Jt,"m",is).call(this,e);if(o.controller.signal?.aborted)throw new _;return this._addRun(ms(this,Jt,"m",os).call(this))}static accumulateDelta(e,t){for(const[s,n]of Object.entries(t)){if(!e.hasOwnProperty(s)){e[s]=n;continue}let t=e[s];if(null!=t)if("index"!==s&&"type"!==s){if("string"==typeof t&&"string"==typeof n)t+=n;else if("number"==typeof t&&"number"==typeof n)t+=n;else if(we(t)&&we(n))t=this.accumulateDelta(t,n);else{if(!Array.isArray(t)||!Array.isArray(n))throw Error(`Unhandled record type: ${s}, deltaValue: ${n}, accValue: ${t}`);if(t.every((e=>"string"==typeof e||"number"==typeof e))){t.push(...n);continue}}e[s]=t}else e[s]=n;else e[s]=n}return e}}is=function(e){if(!this.ended)switch(gs(this,ss,e,"f"),ms(this,Jt,"m",ls).call(this,e),e.event){case"thread.created":break;case"thread.run.created":case"thread.run.queued":case"thread.run.in_progress":case"thread.run.requires_action":case"thread.run.completed":case"thread.run.failed":case"thread.run.cancelling":case"thread.run.cancelled":case"thread.run.expired":ms(this,Jt,"m",fs).call(this,e);break;case"thread.run.step.created":case"thread.run.step.in_progress":case"thread.run.step.delta":case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":ms(this,Jt,"m",cs).call(this,e);break;case"thread.message.created":case"thread.message.in_progress":case"thread.message.delta":case"thread.message.completed":case"thread.message.incomplete":ms(this,Jt,"m",as).call(this,e);break;case"error":throw new Error("Encountered an error event in event processing - errors should be processed earlier")}},os=function(){if(this.ended)throw new y("stream has ended, this shouldn't happen");if(!ms(this,Qt,"f"))throw Error("Final run has not been received");return ms(this,Qt,"f")},as=function(e){const[t,s]=ms(this,Jt,"m",us).call(this,e,ms(this,zt,"f"));gs(this,zt,t,"f"),ms(this,Gt,"f")[t.id]=t;for(const e of s){const s=t.content[e.index];"text"==s?.type&&this._emit("textCreated",s.text)}switch(e.event){case"thread.message.created":this._emit("messageCreated",e.data);break;case"thread.message.in_progress":break;case"thread.message.delta":if(this._emit("messageDelta",e.data.delta,t),e.data.delta.content)for(const s of e.data.delta.content){if("text"==s.type&&s.text){let e=s.text,n=t.content[s.index];if(!n||"text"!=n.type)throw Error("The snapshot associated with this text delta is not text or missing");this._emit("textDelta",e,n.text)}if(s.index!=ms(this,Yt,"f")){if(ms(this,Zt,"f"))switch(ms(this,Zt,"f").type){case"text":this._emit("textDone",ms(this,Zt,"f").text,ms(this,zt,"f"));break;case"image_file":this._emit("imageFileDone",ms(this,Zt,"f").image_file,ms(this,zt,"f"))}gs(this,Yt,s.index,"f")}gs(this,Zt,t.content[s.index],"f")}break;case"thread.message.completed":case"thread.message.incomplete":if(void 0!==ms(this,Yt,"f")){const t=e.data.content[ms(this,Yt,"f")];if(t)switch(t.type){case"image_file":this._emit("imageFileDone",t.image_file,ms(this,zt,"f"));break;case"text":this._emit("textDone",t.text,ms(this,zt,"f"))}}ms(this,zt,"f")&&this._emit("messageDone",e.data),gs(this,zt,void 0,"f")}},cs=function(e){const t=ms(this,Jt,"m",hs).call(this,e);switch(gs(this,rs,t,"f"),e.event){case"thread.run.step.created":this._emit("runStepCreated",e.data);break;case"thread.run.step.delta":const s=e.data.delta;if(s.step_details&&"tool_calls"==s.step_details.type&&s.step_details.tool_calls&&"tool_calls"==t.step_details.type)for(const e of s.step_details.tool_calls)e.index==ms(this,es,"f")?this._emit("toolCallDelta",e,t.step_details.tool_calls[e.index]):(ms(this,ts,"f")&&this._emit("toolCallDone",ms(this,ts,"f")),gs(this,es,e.index,"f"),gs(this,ts,t.step_details.tool_calls[e.index],"f"),ms(this,ts,"f")&&this._emit("toolCallCreated",ms(this,ts,"f")));this._emit("runStepDelta",e.data.delta,t);break;case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":gs(this,rs,void 0,"f"),"tool_calls"==e.data.step_details.type&&ms(this,ts,"f")&&(this._emit("toolCallDone",ms(this,ts,"f")),gs(this,ts,void 0,"f")),this._emit("runStepDone",e.data,t)}},ls=function(e){ms(this,Vt,"f").push(e),this._emit("event",e)},hs=function(e){switch(e.event){case"thread.run.step.created":return ms(this,Kt,"f")[e.data.id]=e.data,e.data;case"thread.run.step.delta":let t=ms(this,Kt,"f")[e.data.id];if(!t)throw Error("Received a RunStepDelta before creation of a snapshot");let s=e.data;if(s.delta){const n=ws.accumulateDelta(t,s.delta);ms(this,Kt,"f")[e.data.id]=n}return ms(this,Kt,"f")[e.data.id];case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":case"thread.run.step.in_progress":ms(this,Kt,"f")[e.data.id]=e.data}if(ms(this,Kt,"f")[e.data.id])return ms(this,Kt,"f")[e.data.id];throw new Error("No snapshot available")},us=function(e,t){let s=[];switch(e.event){case"thread.message.created":return[e.data,s];case"thread.message.delta":if(!t)throw Error("Received a delta with no existing snapshot (there should be one from message creation)");let n=e.data;if(n.delta.content)for(const e of n.delta.content)if(e.index in t.content){let s=t.content[e.index];t.content[e.index]=ms(this,Jt,"m",ds).call(this,e,s)}else t.content[e.index]=e,s.push(e);return[t,s];case"thread.message.in_progress":case"thread.message.completed":case"thread.message.incomplete":if(t)return[t,s];throw Error("Received thread message event with no existing snapshot")}throw Error("Tried to accumulate a non-message event")},ds=function(e,t){return ws.accumulateDelta(t,e)},fs=function(e){switch(gs(this,ns,e.data,"f"),e.event){case"thread.run.created":case"thread.run.queued":case"thread.run.in_progress":case"thread.run.cancelling":break;case"thread.run.requires_action":case"thread.run.cancelled":case"thread.run.failed":case"thread.run.completed":case"thread.run.expired":gs(this,Qt,e.data,"f"),ms(this,ts,"f")&&(this._emit("toolCallDone",ms(this,ts,"f")),gs(this,ts,void 0,"f"))}};class ys extends _e{create(e,t,s){return this._client.post(`/threads/${e}/messages`,{body:t,...s,headers:{"OpenAI-Beta":"assistants=v2",...s?.headers}})}retrieve(e,t,s){return this._client.get(`/threads/${e}/messages/${t}`,{...s,headers:{"OpenAI-Beta":"assistants=v2",...s?.headers}})}update(e,t,s,n){return this._client.post(`/threads/${e}/messages/${t}`,{body:s,...n,headers:{"OpenAI-Beta":"assistants=v2",...n?.headers}})}list(e,t={},s){return ee(t)?this.list(e,{},t):this._client.getAPIList(`/threads/${e}/messages`,bs,{query:t,...s,headers:{"OpenAI-Beta":"assistants=v2",...s?.headers}})}}class bs extends be{}!function(e){e.MessagesPage=bs}(ys||(ys={}));class _s extends _e{retrieve(e,t,s,n){return this._client.get(`/threads/${e}/runs/${t}/steps/${s}`,{...n,headers:{"OpenAI-Beta":"assistants=v2",...n?.headers}})}list(e,t,s={},n){return ee(s)?this.list(e,t,{},s):this._client.getAPIList(`/threads/${e}/runs/${t}/steps`,vs,{query:s,...n,headers:{"OpenAI-Beta":"assistants=v2",...n?.headers}})}}class vs extends be{}!function(e){e.RunStepsPage=vs}(_s||(_s={}));class xs extends _e{constructor(){super(...arguments),this.steps=new _s(this._client)}create(e,t,s){return this._client.post(`/threads/${e}/runs`,{body:t,...s,headers:{"OpenAI-Beta":"assistants=v2",...s?.headers},stream:t.stream??!1})}retrieve(e,t,s){return this._client.get(`/threads/${e}/runs/${t}`,{...s,headers:{"OpenAI-Beta":"assistants=v2",...s?.headers}})}update(e,t,s,n){return this._client.post(`/threads/${e}/runs/${t}`,{body:s,...n,headers:{"OpenAI-Beta":"assistants=v2",...n?.headers}})}list(e,t={},s){return ee(t)?this.list(e,{},t):this._client.getAPIList(`/threads/${e}/runs`,Ss,{query:t,...s,headers:{"OpenAI-Beta":"assistants=v2",...s?.headers}})}cancel(e,t,s){return this._client.post(`/threads/${e}/runs/${t}/cancel`,{...s,headers:{"OpenAI-Beta":"assistants=v2",...s?.headers}})}async createAndPoll(e,t,s){const n=await this.create(e,t,s);return await this.poll(e,n.id,s)}createAndStream(e,t,s){return ws.createAssistantStream(e,this._client.beta.threads.runs,t,s)}async poll(e,t,s){const n={...s?.headers,"X-Stainless-Poll-Helper":"true"};for(s?.pollIntervalMs&&(n["X-Stainless-Custom-Poll-Interval"]=s.pollIntervalMs.toString());;){const{data:r,response:i}=await this.retrieve(e,t,{...s,headers:{...s?.headers,...n}}).withResponse();switch(r.status){case"queued":case"in_progress":case"cancelling":let e=5e3;if(s?.pollIntervalMs)e=s.pollIntervalMs;else{const t=i.headers.get("openai-poll-after-ms");if(t){const s=parseInt(t);isNaN(s)||(e=s)}}await ce(e);break;case"requires_action":case"cancelled":case"completed":case"failed":case"expired":return r}}}stream(e,t,s){return ws.createAssistantStream(e,this._client.beta.threads.runs,t,s)}submitToolOutputs(e,t,s,n){return this._client.post(`/threads/${e}/runs/${t}/submit_tool_outputs`,{body:s,...n,headers:{"OpenAI-Beta":"assistants=v2",...n?.headers},stream:s.stream??!1})}async submitToolOutputsAndPoll(e,t,s,n){const r=await this.submitToolOutputs(e,t,s,n);return await this.poll(e,r.id,n)}submitToolOutputsStream(e,t,s,n){return ws.createToolAssistantStream(e,t,this._client.beta.threads.runs,s,n)}}class Ss extends be{}!function(e){e.RunsPage=Ss,e.Steps=_s,e.RunStepsPage=vs}(xs||(xs={}));class Es extends _e{constructor(){super(...arguments),this.runs=new xs(this._client),this.messages=new ys(this._client)}create(e={},t){return ee(e)?this.create({},e):this._client.post("/threads",{body:e,...t,headers:{"OpenAI-Beta":"assistants=v2",...t?.headers}})}retrieve(e,t){return this._client.get(`/threads/${e}`,{...t,headers:{"OpenAI-Beta":"assistants=v2",...t?.headers}})}update(e,t,s){return this._client.post(`/threads/${e}`,{body:t,...s,headers:{"OpenAI-Beta":"assistants=v2",...s?.headers}})}del(e,t){return this._client.delete(`/threads/${e}`,{...t,headers:{"OpenAI-Beta":"assistants=v2",...t?.headers}})}createAndRun(e,t){return this._client.post("/threads/runs",{body:e,...t,headers:{"OpenAI-Beta":"assistants=v2",...t?.headers},stream:e.stream??!1})}async createAndRunPoll(e,t){const s=await this.createAndRun(e,t);return await this.runs.poll(s.thread_id,s.id,t)}createAndRunStream(e,t){return ws.createThreadAssistantStream(e,this._client.beta.threads,t)}}!function(e){e.Runs=xs,e.RunsPage=Ss,e.Messages=ys,e.MessagesPage=bs}(Es||(Es={}));class As extends _e{create(e,t,s){return this._client.post(`/vector_stores/${e}/files`,{body:t,...s,headers:{"OpenAI-Beta":"assistants=v2",...s?.headers}})}retrieve(e,t,s){return this._client.get(`/vector_stores/${e}/files/${t}`,{...s,headers:{"OpenAI-Beta":"assistants=v2",...s?.headers}})}list(e,t={},s){return ee(t)?this.list(e,{},t):this._client.getAPIList(`/vector_stores/${e}/files`,Rs,{query:t,...s,headers:{"OpenAI-Beta":"assistants=v2",...s?.headers}})}del(e,t,s){return this._client.delete(`/vector_stores/${e}/files/${t}`,{...s,headers:{"OpenAI-Beta":"assistants=v2",...s?.headers}})}async createAndPoll(e,t,s){const n=await this.create(e,t,s);return await this.poll(e,n.id,s)}async poll(e,t,s){const n={...s?.headers,"X-Stainless-Poll-Helper":"true"};for(s?.pollIntervalMs&&(n["X-Stainless-Custom-Poll-Interval"]=s.pollIntervalMs.toString());;){const r=await this.retrieve(e,t,{...s,headers:n}).withResponse(),i=r.data;switch(i.status){case"in_progress":let e=5e3;if(s?.pollIntervalMs)e=s.pollIntervalMs;else{const t=r.response.headers.get("openai-poll-after-ms");if(t){const s=parseInt(t);isNaN(s)||(e=s)}}await ce(e);break;case"failed":case"completed":return i}}}async upload(e,t,s){const n=await this._client.files.create({file:t,purpose:"assistants"},s);return this.create(e,{file_id:n.id},s)}async uploadAndPoll(e,t,s){const n=await this._client.files.create({file:t,purpose:"assistants"},s);return await this.poll(e,n.id,s)}}class Rs extends be{}!function(e){e.VectorStoreFilesPage=Rs}(As||(As={}));class Ps extends _e{create(e,t,s){return this._client.post(`/vector_stores/${e}/file_batches`,{body:t,...s,headers:{"OpenAI-Beta":"assistants=v2",...s?.headers}})}retrieve(e,t,s){return this._client.get(`/vector_stores/${e}/file_batches/${t}`,{...s,headers:{"OpenAI-Beta":"assistants=v2",...s?.headers}})}cancel(e,t,s){return this._client.post(`/vector_stores/${e}/file_batches/${t}/cancel`,{...s,headers:{"OpenAI-Beta":"assistants=v2",...s?.headers}})}async createAndPoll(e,t,s){const n=await this.create(e,t);return await this.poll(e,n.id,s)}listFiles(e,t,s={},n){return ee(s)?this.listFiles(e,t,{},s):this._client.getAPIList(`/vector_stores/${e}/file_batches/${t}/files`,Rs,{query:s,...n,headers:{"OpenAI-Beta":"assistants=v2",...n?.headers}})}async poll(e,t,s){const n={...s?.headers,"X-Stainless-Poll-Helper":"true"};for(s?.pollIntervalMs&&(n["X-Stainless-Custom-Poll-Interval"]=s.pollIntervalMs.toString());;){const{data:r,response:i}=await this.retrieve(e,t,{...s,headers:n}).withResponse();switch(r.status){case"in_progress":let e=5e3;if(s?.pollIntervalMs)e=s.pollIntervalMs;else{const t=i.headers.get("openai-poll-after-ms");if(t){const s=parseInt(t);isNaN(s)||(e=s)}}await ce(e);break;case"failed":case"completed":return r}}}async uploadAndPoll(e,{files:t,fileIds:s=[]},n){if(null===t||0==t.length)throw new Error("No files provided to process.");const r=n?.maxConcurrency??5,i=Math.min(r,t.length),o=this._client,a=t.values(),c=[...s],l=Array(i).fill(a).map((async function(e){for(let t of e){const e=await o.files.create({file:t,purpose:"assistants"},n);c.push(e.id)}}));return await(async e=>{const t=await Promise.allSettled(e),s=t.filter((e=>"rejected"===e.status));if(s.length){for(const e of s)console.error(e.reason);throw new Error(`${s.length} promise(s) failed - see the above errors`)}const n=[];for(const e of t)"fulfilled"===e.status&&n.push(e.value);return n})(l),await this.createAndPoll(e,{file_ids:c})}}Ps||(Ps={});class Is extends _e{constructor(){super(...arguments),this.files=new As(this._client),this.fileBatches=new Ps(this._client)}create(e,t){return this._client.post("/vector_stores",{body:e,...t,headers:{"OpenAI-Beta":"assistants=v2",...t?.headers}})}retrieve(e,t){return this._client.get(`/vector_stores/${e}`,{...t,headers:{"OpenAI-Beta":"assistants=v2",...t?.headers}})}update(e,t,s){return this._client.post(`/vector_stores/${e}`,{body:t,...s,headers:{"OpenAI-Beta":"assistants=v2",...s?.headers}})}list(e={},t){return ee(e)?this.list({},e):this._client.getAPIList("/vector_stores",Cs,{query:e,...t,headers:{"OpenAI-Beta":"assistants=v2",...t?.headers}})}del(e,t){return this._client.delete(`/vector_stores/${e}`,{...t,headers:{"OpenAI-Beta":"assistants=v2",...t?.headers}})}}class Cs extends be{}!function(e){e.VectorStoresPage=Cs,e.Files=As,e.VectorStoreFilesPage=Rs,e.FileBatches=Ps}(Is||(Is={}));class ks extends _e{constructor(){super(...arguments),this.vectorStores=new Is(this._client),this.chat=new kt(this._client),this.assistants=new We(this._client),this.threads=new Es(this._client)}}!function(e){e.VectorStores=Is,e.VectorStoresPage=Cs,e.Chat=kt,e.Assistants=We,e.AssistantsPage=De,e.Threads=Es}(ks||(ks={}));class Os extends _e{create(e,t){return this._client.post("/batches",{body:e,...t})}retrieve(e,t){return this._client.get(`/batches/${e}`,t)}list(e={},t){return ee(e)?this.list({},e):this._client.getAPIList("/batches",Ts,{query:e,...t})}cancel(e,t){return this._client.post(`/batches/${e}/cancel`,t)}}class Ts extends be{}!function(e){e.BatchesPage=Ts}(Os||(Os={}));class $s extends G{constructor({baseURL:e=ue("OPENAI_BASE_URL"),apiKey:t=ue("OPENAI_API_KEY"),organization:s=ue("OPENAI_ORG_ID")??null,project:n=ue("OPENAI_PROJECT_ID")??null,...r}={}){if(void 0===t)throw new y("The OPENAI_API_KEY environment variable is missing or empty; either provide it, or instantiate the OpenAI client with an apiKey option, like new OpenAI({ apiKey: 'My API Key' }).");const i={apiKey:t,organization:s,project:n,...r,baseURL:e||"https://api.openai.com/v1"};if(!i.dangerouslyAllowBrowser&&"undefined"!=typeof window&&void 0!==window.document&&"undefined"!=typeof navigator)throw new y("It looks like you're running in a browser-like environment.\n\nThis is disabled by default, as it risks exposing your secret API credentials to attackers.\nIf you understand the risks and have appropriate mitigations in place,\nyou can set the `dangerouslyAllowBrowser` option to `true`, e.g.,\n\nnew OpenAI({ apiKey, dangerouslyAllowBrowser: true });\n\nhttps://help.openai.com/en/articles/5112595-best-practices-for-api-key-safety\n");super({baseURL:i.baseURL,timeout:i.timeout??6e5,httpAgent:i.httpAgent,maxRetries:i.maxRetries,fetch:i.fetch}),this.completions=new ve(this),this.chat=new Se(this),this.embeddings=new Ee(this),this.files=new Ae(this),this.images=new Pe(this),this.audio=new Oe(this),this.moderations=new Te(this),this.models=new $e(this),this.fineTuning=new Fe(this),this.beta=new ks(this),this.batches=new Os(this),this._options=i,this.apiKey=t,this.organization=s,this.project=n}defaultQuery(){return this._options.defaultQuery}defaultHeaders(e){return{...super.defaultHeaders(e),"OpenAI-Organization":this.organization,"OpenAI-Project":this.project,...this._options.defaultHeaders}}authHeaders(e){return{Authorization:`Bearer ${this.apiKey}`}}}ps=$s,$s.OpenAI=ps,$s.OpenAIError=y,$s.APIError=b,$s.APIConnectionError=v,$s.APIConnectionTimeoutError=x,$s.APIUserAbortError=_,$s.NotFoundError=R,$s.ConflictError=P,$s.RateLimitError=C,$s.BadRequestError=S,$s.AuthenticationError=E,$s.InternalServerError=k,$s.PermissionDeniedError=A,$s.UnprocessableEntityError=I;const{OpenAIError:Ms,APIError:Bs,APIConnectionError:js,APIConnectionTimeoutError:qs,APIUserAbortError:Ls,NotFoundError:Ns,ConflictError:Fs,RateLimitError:Ws,BadRequestError:Ds,AuthenticationError:Us,InternalServerError:Xs,PermissionDeniedError:Hs,UnprocessableEntityError:Js}=t;!function(e){e.toFile=N,e.fileFromPath=h,e.Page=ye,e.CursorPage=be,e.Completions=ve,e.Chat=Se,e.Embeddings=Ee,e.Files=Ae,e.FileObjectsPage=Re,e.Images=Pe,e.Audio=Oe,e.Moderations=Te,e.Models=$e,e.ModelsPage=Me,e.FineTuning=Fe,e.Beta=ks,e.Batches=Os,e.BatchesPage=Ts}($s||($s={}));const Vs=$s,Ks=new webkitSpeechRecognition||new SpeechRecognition;Ks.interimResults=!0,Ks.continuous=!0;let Gs=0,zs=!0,Qs=[];const Ys=new class{constructor(){this.elements=[],this.openai=new Vs({apiKey:"sigma",dangerouslyAllowBrowser:!0})}enqueue(e){this.elements.push(e)}dequeue(){const e=this.elements[0];return delete this.elements[this.frontIndex],e}getFrontElement(){return this.elements[0]}getQueue(){return this.elements}checkFull(){return this.elements.length>=10}async response(){const e=await this.openai.chat.completions.create({messages:[{role:"system",content:"summarize and provide one sentence of notes for each input from the transcript. Make sure they accurately reflect the topic of the notes, as students will be using these in order to study, but also make sure they are not too long as the point is to summarize it concicely for the students use. correct for any unintended mistakes. each input from the transcript is around 10 sentences long. If you are unable to access the transcript, do not return anything."},{role:"user",content:this.elements.join("")}],model:"gpt-3.5-turbo-0125"});console.log(e.choices[0].message.content),document.getElementById("notesText").innerText+=e.choices[0].message.content+"\n\n",document.getElementById("notesTextDiv").scrollTo(0,document.getElementById("notesText").scrollHeight),this.elements=[]}};function Zs(e){"rawText"===e&&(console.log("raw"),document.getElementById("rawText").textContent=""),"notesText"===e&&(console.log("notes"),document.getElementById("notesText").textContent="")}document.getElementById("voiceButton").addEventListener("click",(function(){zs?(document.getElementById("rawText").innerText+="\n---------- Recording Started. ----------",document.getElementById("voiceButton").style.backgroundColor="red",document.getElementById("voiceButton").textContent="Stop Recording!",alert("RECORDING STARTED! NOW LOGGING TRANSCRIPT FOR NOTES TAKING!"),Ks.start()):zs||(Ks.stop(),document.getElementById("voiceButton").style.backgroundColor="#072345",document.getElementById("voiceButton").textContent="Start Recording!",alert("RECORDING STOPPED! CHECK OUT YOUR NOTES BELOW!")),zs=!zs})),document.getElementById("deleteButtonRaw").addEventListener("click",(()=>Zs("rawText"))),document.getElementById("deleteButtonNotes").addEventListener("click",(()=>Zs("notesText"))),document.getElementById("printButton").addEventListener("click",(()=>{return(e=window.open("","","left=0,top=0,width=800,height=900,toolbar=0,scrollbars=0,status=0")).document.write(document.getElementById("notesText").innerHTML),e.document.close(),e.focus(),e.print(),void e.close();var e})),Ks.onresult=e=>{const t=e.results[e.results.length-1];t.isFinal&&(Qs.push(t[0].transcript),console.log(Ys.getQueue()),document.getElementById("rawText").innerText+="\n\n"+Qs[Gs].toString(),document.getElementById("rawTextDiv").scrollTo(0,document.getElementById("rawText").scrollHeight),Gs+=1,Ys.checkFull()&&(console.log("full"),Ys.response()),Ys.enqueue(t[0].transcript))},Ks.onend=()=>{Qs=[],Gs=0,Ys.response(),document.getElementById("rawText").innerText+="\n\n---------- Recording Stopped. ----------",console.log("finished")},Ks.onerror=e=>{console.error("Speech recognition error:",e.error)},Ks.onnomatch=()=>{console.log("No speech was recognized.")}})();